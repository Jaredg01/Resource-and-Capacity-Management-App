{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/SAIT/capstone_project/Resource-and-Capacity-Management-App/resource-and-capacity-management-app/app/api/Resource-Manager/summary/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { MongoClient } from 'mongodb';\r\n\r\n/* ---------------------------------------------------------\r\n   MONGODB CONNECTION SETUP\r\n--------------------------------------------------------- */\r\n\r\nconst uri = process.env.MONGODB_URI;\r\nconst client = new MongoClient(uri);\r\n\r\n/* ---------------------------------------------------------\r\n   CONNECT TO DATABASE\r\n--------------------------------------------------------- */\r\nasync function connectDB() {\r\n  if (!client.topology || !client.topology.isConnected()) {\r\n    await client.connect();\r\n    console.log(\"Connected to MongoDB (Summary API)\");\r\n  }\r\n  return client.db();\r\n}\r\n\r\n/* ---------------------------------------------------------\r\n   GET /api/Resource-Manager/summary\r\n--------------------------------------------------------- */\r\nexport async function GET(req) {\r\n  try {\r\n    const db = await connectDB();\r\n    const { searchParams } = new URL(req.url);\r\n\r\n    const filter = searchParams.get(\"filter\");\r\n    const username = searchParams.get(\"username\");\r\n\r\n    let baseQuery = {};\r\n\r\n    /* ---------------------------------------------------------\r\n       MINE FILTER LOGIC\r\n    --------------------------------------------------------- */\r\n    if (filter === \"mine\" && username) {\r\n      const accountDoc = await db.collection(\"account\").findOne({\r\n        \"account.username\": username.trim()\r\n      });\r\n\r\n      if (!accountDoc) {\r\n        return NextResponse.json({\r\n          backlog: 0,\r\n          active: 0,\r\n          hold: 0\r\n        });\r\n      }\r\n\r\n      const employee = await db.collection(\"employee\").findOne({\r\n        emp_id: accountDoc.emp_id\r\n      });\r\n\r\n      if (!employee) {\r\n        return NextResponse.json({\r\n          backlog: 0,\r\n          active: 0,\r\n          hold: 0\r\n        });\r\n      }\r\n\r\n      baseQuery.leader = employee.emp_name;\r\n    }\r\n\r\n    /* ---------------------------------------------------------\r\n       INITIATIVE COUNTS (Planned Removed)\r\n    --------------------------------------------------------- */\r\n\r\n    const backlog = await db.collection(\"assignment\").countDocuments({\r\n      ...baseQuery,\r\n      status: \"Backlog\"\r\n    });\r\n\r\n    const active = await db.collection(\"assignment\").countDocuments({\r\n      ...baseQuery,\r\n      status: { $in: [\"On Going\", \"In Progress\"] }\r\n    });\r\n\r\n    const hold = await db.collection(\"assignment\").countDocuments({\r\n      ...baseQuery,\r\n      status: \"On Hold\"\r\n    });\r\n\r\n    /* ---------------------------------------------------------\r\n       RESPONSE PAYLOAD (Planned Removed)\r\n    --------------------------------------------------------- */\r\n    return NextResponse.json({\r\n      backlog,\r\n      active,\r\n      hold\r\n    });\r\n\r\n  } catch (err) {\r\n    console.error(\"Summary API error:\", err);\r\n    return NextResponse.json({ error: \"Server error\" }, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA;;0DAE0D,GAE1D,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,MAAM,SAAS,IAAI,wNAAW,CAAC;AAE/B;;0DAE0D,GAC1D,eAAe;IACb,IAAI,CAAC,OAAO,QAAQ,IAAI,CAAC,OAAO,QAAQ,CAAC,WAAW,IAAI;QACtD,MAAM,OAAO,OAAO;QACpB,QAAQ,GAAG,CAAC;IACd;IACA,OAAO,OAAO,EAAE;AAClB;AAKO,eAAe,IAAI,GAAG;IAC3B,IAAI;QACF,MAAM,KAAK,MAAM;QACjB,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;QAExC,MAAM,SAAS,aAAa,GAAG,CAAC;QAChC,MAAM,WAAW,aAAa,GAAG,CAAC;QAElC,IAAI,YAAY,CAAC;QAEjB;;8DAE0D,GAC1D,IAAI,WAAW,UAAU,UAAU;YACjC,MAAM,aAAa,MAAM,GAAG,UAAU,CAAC,WAAW,OAAO,CAAC;gBACxD,oBAAoB,SAAS,IAAI;YACnC;YAEA,IAAI,CAAC,YAAY;gBACf,OAAO,oMAAY,CAAC,IAAI,CAAC;oBACvB,SAAS;oBACT,QAAQ;oBACR,MAAM;gBACR;YACF;YAEA,MAAM,WAAW,MAAM,GAAG,UAAU,CAAC,YAAY,OAAO,CAAC;gBACvD,QAAQ,WAAW,MAAM;YAC3B;YAEA,IAAI,CAAC,UAAU;gBACb,OAAO,oMAAY,CAAC,IAAI,CAAC;oBACvB,SAAS;oBACT,QAAQ;oBACR,MAAM;gBACR;YACF;YAEA,UAAU,MAAM,GAAG,SAAS,QAAQ;QACtC;QAEA;;8DAE0D,GAE1D,MAAM,UAAU,MAAM,GAAG,UAAU,CAAC,cAAc,cAAc,CAAC;YAC/D,GAAG,SAAS;YACZ,QAAQ;QACV;QAEA,MAAM,SAAS,MAAM,GAAG,UAAU,CAAC,cAAc,cAAc,CAAC;YAC9D,GAAG,SAAS;YACZ,QAAQ;gBAAE,KAAK;oBAAC;oBAAY;iBAAc;YAAC;QAC7C;QAEA,MAAM,OAAO,MAAM,GAAG,UAAU,CAAC,cAAc,cAAc,CAAC;YAC5D,GAAG,SAAS;YACZ,QAAQ;QACV;QAEA;;8DAE0D,GAC1D,OAAO,oMAAY,CAAC,IAAI,CAAC;YACvB;YACA;YACA;QACF;IAEF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,oMAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;AACF"}}]
}