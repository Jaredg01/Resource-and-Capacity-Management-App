{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/SAIT/capstone_project/Resource-and-Capacity-Management-App/resource-and-capacity-management-app/lib/database/mongodb.js"],"sourcesContent":["import { MongoClient, ServerApiVersion } from 'mongodb';\r\n// Import MongoDB client and server API versioning\r\n\r\nlet client; // Cached MongoClient instance\r\nlet db;     // Cached database instance\r\n\r\n// Connection URI (environment variable or fallback to local MongoDB)\r\nconst uri = process.env.MONGODB_URI || 'mongodb://localhost:27017';\r\n\r\n// Database name (environment variable or default)\r\nconst dbName = process.env.DB_NAME || 'ResourceManagementAPP_DB';\r\n\r\n/**\r\n * Connect to MongoDB\r\n * Ensures a single shared connection across the entire app.\r\n * @returns {Promise<Db>} Database instance\r\n */\r\nexport async function connectDB() {\r\n  // If already connected, return existing DB instance\r\n  if (db) {\r\n    return db;\r\n  }\r\n\r\n  try {\r\n    // Initialize MongoClient only once\r\n    if (!client) {\r\n      client = new MongoClient(uri, {\r\n        serverApi: {\r\n          version: ServerApiVersion.v1, // Use stable API version\r\n          strict: true,                 // Enforce strict mode\r\n          deprecationErrors: true       // Warn on deprecated features\r\n        }\r\n      });\r\n    }\r\n\r\n    // Establish connection\r\n    await client.connect();\r\n\r\n    // Select the database\r\n    db = client.db(dbName);\r\n\r\n    // Ping the server to verify connection\r\n    await db.command({ ping: 1 });\r\n    console.log('Connected to MongoDB successfully');\r\n\r\n    return db;\r\n  } catch (error) {\r\n    console.error('MongoDB connection error:', error);\r\n    throw error; // Re-throw so calling code can handle it\r\n  }\r\n}\r\n\r\n/**\r\n * Get database instance\r\n * Ensures connectDB() was called before accessing DB.\r\n * @returns {Db} Database instance\r\n */\r\nexport function getDB() {\r\n  if (!db) {\r\n    throw new Error('Database not initialized. Call connectDB() first.');\r\n  }\r\n  return db;\r\n}\r\n\r\n/**\r\n * Close database connection\r\n * Safely shuts down the MongoClient and clears cached instances.\r\n */\r\nexport async function closeDB() {\r\n  if (client) {\r\n    await client.close();\r\n    client = null;\r\n    db = null;\r\n    console.log('MongoDB connection closed');\r\n  }\r\n}"],"names":[],"mappings":";;;;;;;;AAAA;;AACA,kDAAkD;AAElD,IAAI,QAAQ,8BAA8B;AAC1C,IAAI,IAAQ,2BAA2B;AAEvC,qEAAqE;AACrE,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW,IAAI;AAEvC,kDAAkD;AAClD,MAAM,SAAS,QAAQ,GAAG,CAAC,OAAO,IAAI;AAO/B,eAAe;IACpB,oDAAoD;IACpD,IAAI,IAAI;QACN,OAAO;IACT;IAEA,IAAI;QACF,mCAAmC;QACnC,IAAI,CAAC,QAAQ;YACX,SAAS,IAAI,wNAAW,CAAC,KAAK;gBAC5B,WAAW;oBACT,SAAS,6NAAgB,CAAC,EAAE;oBAC5B,QAAQ;oBACR,mBAAmB,KAAW,8BAA8B;gBAC9D;YACF;QACF;QAEA,uBAAuB;QACvB,MAAM,OAAO,OAAO;QAEpB,sBAAsB;QACtB,KAAK,OAAO,EAAE,CAAC;QAEf,uCAAuC;QACvC,MAAM,GAAG,OAAO,CAAC;YAAE,MAAM;QAAE;QAC3B,QAAQ,GAAG,CAAC;QAEZ,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,MAAM,OAAO,yCAAyC;IACxD;AACF;AAOO,SAAS;IACd,IAAI,CAAC,IAAI;QACP,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;AAMO,eAAe;IACpB,IAAI,QAAQ;QACV,MAAM,OAAO,KAAK;QAClB,SAAS;QACT,KAAK;QACL,QAAQ,GAAG,CAAC;IACd;AACF"}},
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///C:/SAIT/capstone_project/Resource-and-Capacity-Management-App/resource-and-capacity-management-app/app/api/Resource-Manager/Employees/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { connectDB } from '@/lib/database/mongodb'; \r\n\r\nexport async function GET() {\r\n  try {\r\n    const db = await connectDB();\r\n\r\n    const employees = await db.collection(\"employee\").aggregate([\r\n      // 1. Join with Department\r\n      {\r\n        $lookup: {\r\n          from: \"department\",\r\n          localField: \"dept_no\",\r\n          foreignField: \"dept_no\",\r\n          as: \"dept_info\"\r\n        }\r\n      },\r\n      // 2. Join with Capacity\r\n      {\r\n        $lookup: {\r\n          from: \"capacity\",\r\n          localField: \"emp_id\",\r\n          foreignField: \"emp_id\",\r\n          as: \"capacity_info\"\r\n        }\r\n      },\r\n      // 3. SELF-LOOKUP: Join employee with itself to get Manager Name\r\n      {\r\n        $lookup: {\r\n          from: \"employee\",\r\n          localField: \"manager_id\",\r\n          foreignField: \"emp_id\",\r\n          as: \"manager_info\"\r\n        }\r\n      },\r\n      // 4. Project the final structure\r\n      {\r\n        $project: {\r\n          _id: 1,\r\n          emp_id: 1,\r\n          emp_name: 1,\r\n          emp_title: 1,\r\n          dept_no: 1,\r\n          manager_id: 1,\r\n          dept_name: { $arrayElemAt: [\"$dept_info.dept_name\", 0] },\r\n          // Extract the name from the manager_info array\r\n          manager_name: { $arrayElemAt: [\"$manager_info.emp_name\", 0] },\r\n          capacity: \"$capacity_info\"\r\n        }\r\n      }\r\n    ]).toArray();\r\n\r\n    return NextResponse.json(employees);\r\n  } catch (e) {\r\n    console.error(\"API Error:\", e);\r\n    return NextResponse.json({ error: e.message }, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,KAAK,MAAM,IAAA,6LAAS;QAE1B,MAAM,YAAY,MAAM,GAAG,UAAU,CAAC,YAAY,SAAS,CAAC;YAC1D,0BAA0B;YAC1B;gBACE,SAAS;oBACP,MAAM;oBACN,YAAY;oBACZ,cAAc;oBACd,IAAI;gBACN;YACF;YACA,wBAAwB;YACxB;gBACE,SAAS;oBACP,MAAM;oBACN,YAAY;oBACZ,cAAc;oBACd,IAAI;gBACN;YACF;YACA,gEAAgE;YAChE;gBACE,SAAS;oBACP,MAAM;oBACN,YAAY;oBACZ,cAAc;oBACd,IAAI;gBACN;YACF;YACA,iCAAiC;YACjC;gBACE,UAAU;oBACR,KAAK;oBACL,QAAQ;oBACR,UAAU;oBACV,WAAW;oBACX,SAAS;oBACT,YAAY;oBACZ,WAAW;wBAAE,cAAc;4BAAC;4BAAwB;yBAAE;oBAAC;oBACvD,+CAA+C;oBAC/C,cAAc;wBAAE,cAAc;4BAAC;4BAA0B;yBAAE;oBAAC;oBAC5D,UAAU;gBACZ;YACF;SACD,EAAE,OAAO;QAEV,OAAO,oMAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC,cAAc;QAC5B,OAAO,oMAAY,CAAC,IAAI,CAAC;YAAE,OAAO,EAAE,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IAC/D;AACF"}}]
}